resources:
  repositories:
  - repository: iotedge # The name used to reference this repository in the checkout step
    type: github
    endpoint: azure-iot-edge-iotedge1-github
    name: azure/iotedge
  - repository: azure-iotedge
    type: github
    endpoint: azure-iot-edge-iotedge1-github
    name: azure/azure-iotedge

trigger:
- main

# steps:
# - checkout: self
# - checkout: iotedge
# - checkout: azure-iotedge

stages:
  - stage: TestStage
    displayName: Stage 1
    pool:
      name: 'Azure-IoT-Edge-1ES-Hosted-Linux'
      demands:
        - ImageOverride -equals agent-aziotedge-ubuntu-20.04-docker
    jobs:
    - job: job1
      displayName: Ubuntu 18.04 - amd64
      steps:
      - checkout: self
        submodules: recursive
      - checkout: iotedge
        submodules: recursive
      - checkout: azure-iotedge
        submodules: recursive
      - bash: |
          echo "=============================================="
          echo "Build.SourcesDirectory: $(Build.SourcesDirectory)"
          ls -a $(Build.SourcesDirectory)
          # find $(Build.SourcesDirectory) -type d | sed -e "s/[^-][^\/]*\// |/g" -e "s/|\([^ ]\)/|-\1/"
          # ls -R $(Build.SourcesDirectory) | grep ":$" | sed -e 's/:$//' -e 's/[^-][^\/]*\//--/g' -e 's/^/   /' -e 's/-/|/'
          echo " "
          echo "=============================================="
          echo "Agent.BuildDirectory:   $(Agent.BuildDirectory)"
          ls -a $(Agent.BuildDirectory)
          # find $(Agent.BuildDirectory) -type d | sed -e "s/[^-][^\/]*\// |/g" -e "s/|\([^ ]\)/|-\1/"
          # ls -R $(Agent.BuildDirectory) | grep ":$" | sed -e 's/:$//' -e 's/[^-][^\/]*\//--/g' -e 's/^/   /' -e 's/-/|/'
