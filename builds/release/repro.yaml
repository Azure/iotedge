pr: none
trigger: none

resources:
  pipelines:
  - pipeline: upstream
    source: 'Upstream pipeline'
    trigger: true

variables:
  DisableDockerDetector: true

stages:
- stage: A
  dependsOn: []
  condition: eq(variables['Build.Reason'],'ResourceTrigger')
  jobs:
  - job: a
    steps:
    - script: echo 'a'

- stage: B
  dependsOn: A
  condition: or(ne(variables['Build.Reason'],'ResourceTrigger'), succeeded())
  jobs:
  - job: b
    steps:
    - script: echo 'b'

- stage: C
  dependsOn: A
  condition: or(ne(variables['Build.Reason'],'ResourceTrigger'), succeeded())
  jobs:
  - job: c
    steps:
    - script: echo 'c'

- stage: D
  dependsOn:
  - A
  - B
  - C
  condition: and(
    in(dependencies.A.result, 'Succeeded', 'SucceededWithIssues', 'Skipped'),
    in(dependencies.B.result, 'Succeeded', 'SucceededWithIssues'),
    in(dependencies.C.result, 'Succeeded', 'SucceededWithIssues')
  )
  jobs:
  - job: d
    steps:
    - script: echo 'd'
