trigger:
  batch: true
  branches:
    include:
      - master
pr: none

jobs:
################################################################################
  - job: linux_amd64
################################################################################
    displayName: Linux AMD64
    pool:
      vmImage: 'ubuntu-16.04'
    steps:
      - bash: 'docker login $(registry.address) --username $(registry.user) --password $(registry.password)'
        displayName: 'Docker Login'

      - script: scripts/mqtt/build/linux/buildImage.sh amd64 $(registry.address) $(registry.user) $(registry.password)
        name: build
        displayName: Build amd64

      - bash: 'docker push $(registry.address)/azureiotedge/mqttd-linux-amd64'
        displayName: 'Docker Push'

################################################################################
  - job: linux_arm32
################################################################################
    displayName: Linux ARM32
    pool:
      vmImage: 'ubuntu-16.04'
    steps:
      - bash: 'docker login $(registry.address) --username $(registry.user) --password $(registry.password)'
        displayName: 'Docker Login'

      - script: scripts/mqtt/build/linux/buildImage.sh armv7 $(registry.address) $(registry.user) $(registry.password)
        name: build
        displayName: Build armv7

      - bash: 'docker push $(registry.address)/azureiotedge/mqttd-linux-arm32v7'
        displayName: 'Docker Push'