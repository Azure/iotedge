trigger:
  batch: true
  branches:
    include:
      - master
pr: none

jobs:
################################################################################
  - job: linux_amd64
################################################################################
    displayName: Linux AMD64
    pool:
      vmImage: 'ubuntu-16.04'

    variables:
      imageName: $(registry.address)/azureiotedge/mqttd-linux-amd64

    steps:
      - bash: 'docker login $(registry.address) --username $(registry.user) --password $(registry.password)'
        displayName: 'Docker Login'

      - task: Docker@2
        displayName: Build amd64 image
        inputs:
          repository: $(imageName)
          command: build
          Dockerfile: mqtt/docker/linux/amd64/Dockerfile

      - bash: 'docker push $(imageName)'
        displayName: 'Docker Push'

# ################################################################################
#   - job: linux_arm32
# ################################################################################
#     displayName: Linux ARM32
#     pool:
#       vmImage: 'ubuntu-16.04'

#     variables:
#       imageName: $(registry.address)/azureiotedge/mqttd-linux-arm32v7

#     steps:
#       - bash: 'docker login $(registry.address) --username $(registry.user) --password $(registry.password)'
#         displayName: 'Docker Login'

#       - task: Docker@2
#         displayName: Build arm32 image
#         inputs:
#           repository: $(imageName)
#           command: build
#           Dockerfile: mqtt/docker/linux/arm32v7/Dockerfile

#       - bash: 'docker push $(imageName)'
#         displayName: 'Docker Push'