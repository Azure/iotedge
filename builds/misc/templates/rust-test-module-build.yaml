jobs:
  - job: BuildRustModule
    displayName: Build Rust Module
    strategy:
      matrix:
        GenericMqttTesterAmd64:
          arch: amd64
          moduleFolderName: generic-mqtt-tester
          displayName: Build generic mqtt tester - amd64
        GenericMqttTesterArm32:
          arch: arm32v7
          moduleFolderName: generic-mqtt-tester
          displayName: Build generic mqtt tester - arm32
        GenericMqttTesterArm64:
          arch: aarch64
          moduleFolderName: generic-mqtt-tester
          displayName: Build generic mqtt tester - arm64
    steps:
      - task: Bash@3
        displayName: $(displayName)
        inputs:
          filePath: scripts/linux/cross-platform-rust-build.sh
          arguments: --os ubuntu18.04 --arch $(arch) --build-path test/modules/$(moduleFolderName)
      - task: PublishPipelineArtifact@1
        inputs:
          targetPath: '$(Build.BinariesDirectory)/publish'
          artifactName: '$(moduleFolderName)_$(arch)'
          artifactType: 'pipeline'
