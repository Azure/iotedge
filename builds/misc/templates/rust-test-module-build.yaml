jobs:
  - job: BuildRustExecutable
    displayName: Build Rust Executable
    strategy:
      matrix:
        GenericMqttTesterAmd64:
          arch: amd64
          displayName: Build generic mqtt tester - amd64
          moduleName: generic-mqtt-tester
          modulePath: test/modules/generic-mqtt-tester
          target: x86_64-unknown-linux-musl
        GenericMqttTesterArm32:
          arch: arm32v7
          displayName: Build generic mqtt tester - arm32
          moduleName: generic-mqtt-tester
          modulePath: test/modules/generic-mqtt-tester     
          target: armv7-unknown-linux-gnueabihf  
        GenericMqttTesterArm64:
          arch: aarch64
          displayName: Build generic mqtt tester - arm64
          moduleName: generic-mqtt-tester
          modulePath: test/modules/generic-mqtt-tester
          target: aarch64-unknown-linux-gnu
    steps:
      - task: Bash@3
        displayName: $(displayName)
        inputs:
          filePath: scripts/linux/cross-platform-rust-build.sh
          arguments: --os ubuntu18.04 --arch $(arch) --build-path $(modulePath)
      - task: PublishPipelineArtifact@1
        inputs:
          targetPath: '$(modulePath)/target/$(target)/release/$(moduleName)'
          artifactName: '$(modulePath)_$(arch)'
          artifactType: 'pipeline'
