parameters:
  name: ''
  imageName: ''
  namespace: 'microsoft'
  project: ''
  version: ''
  buildx_flag: ''
  bin_dir: ''

jobs:
  - job:
    displayName: Build Image - ${{ parameters.name }} - amd64
    steps:
    - task: Bash@3
      inputs:
        filePath: scripts/linux/buildImage.sh
        arguments: -r "$(registry.address)" -i "${{ parameters.imageName }}" -n "${{ parameters.namespace }}" -P "${{ parameters.project }}" -v "${{ parameters.version }}" --bin-dir "${{ parameters.bin_dir }}"
  - job:
    displayName: Build Image - ${{ parameters.name }} - arm32
    steps:  
    - task: Bash@3
      inputs:
        filePath: scripts/linux/buildImage.sh
        arguments: -r "$(registry.address)" -i "${{ parameters.imageName }}" -n "${{ parameters.namespace }}" -P "${{ parameters.project }}" -v "${{ parameters.version }}" --target-arch armv7l --buildx_flag ${{ parameters.buildx_flag }} --bin-dir "${{ parameters.bin_dir }}  
  - job:
    displayName: Build Image - ${{ parameters.name }} - arm64 
    steps:
    - task: Bash@3
      condition: and(ne('${{ parameters.name }}', 'Functions Sample'), succeeded())
      inputs:
        filePath: scripts/linux/buildImage.sh
        arguments: -r "$(registry.address)" -i "${{ parameters.imageName }}" -n "${{ parameters.namespace }}" -P "${{ parameters.project }}" -v "${{ parameters.version }}" --target-arch aarch64 --buildx_flag ${{ parameters.buildx_flag }} --bin-dir "${{ parameters.bin_dir }}