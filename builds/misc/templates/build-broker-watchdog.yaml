jobs:
  - job: BuildMqttBrokerAmd64
    steps:
    - task: Bash@3
      displayName: Build MQTT Broker - amd64
      inputs:
        filePath: scripts/linux/cross-platform-rust-build.sh
        arguments: --os alpine --arch amd64 --build-path mqtt/mqttd
    - task: PublishPipelineArtifact@1
      inputs:
        targetPath: 'mqtt/target/x86_64-unknown-linux-musl/release/mqttd'
        artifactName: mqttd_amd64
        artifactType: 'pipeline'
  - job: BuildMqttBrokerArm32
    steps:
    - task: Bash@3
      displayName: Build MQTT Broker - arm32
      inputs:
        filePath: scripts/linux/cross-platform-rust-build.sh
        arguments: --os ubuntu18.04 --arch arm32v7 --build-path mqtt/mqttd
    - task: PublishPipelineArtifact@1
      inputs:
        targetPath: 'mqtt/target/armv7-unknown-linux-gnueabihf/release/mqttd'
        artifactName: mqttd_arm32
        artifactType: 'pipeline'
  - job: BuildMqttBrokerArm64        
    steps:
    - task: Bash@3
      displayName: Build MQTT Broker - arm64
      inputs:
        filePath: scripts/linux/cross-platform-rust-build.sh
        arguments: --os ubuntu18.04 --arch aarch64 --build-path mqtt/mqttd
    - task: PublishPipelineArtifact@1
      inputs:
        targetPath: 'mqtt/target/aarch64-unknown-linux-gnu/release/mqttd'
        artifactName: mqttd_arm64
        artifactType: 'pipeline'
  - job: BuildWatchdogAmd64        
    steps:
    - task: Bash@3
      displayName: Build watchdog - amd64
      inputs:
        filePath: scripts/linux/cross-platform-rust-build.sh
        arguments: --os alpine --arch amd64 --build-path edge-hub/watchdog
    - task: PublishPipelineArtifact@1
      inputs:
        targetPath: 'edge-hub/watchdog/target/x86_64-unknown-linux-musl/release/watchdog'
        artifactName: watchdog_amd64
        artifactType: 'pipeline'
  - job: BuildWatchdogArm32                
    steps:
    - task: Bash@3
      displayName: Build watchdog - arm32
      inputs:
        filePath: scripts/linux/cross-platform-rust-build.sh
        arguments: --os ubuntu18.04 --arch arm32v7 --build-path edge-hub/watchdog
    - task: PublishPipelineArtifact@1
      inputs:
        targetPath: 'edge-hub/watchdog/target/armv7-unknown-linux-gnueabihf/release/watchdog'
        artifactName: watchdog_arm32
        artifactType: 'pipeline'
  - job: BuildWatchdogArm64      
    steps:
    - task: Bash@3
      displayName: Build watchdog - arm64
      inputs:
        filePath: scripts/linux/cross-platform-rust-build.sh
        arguments: --os ubuntu18.04 --arch aarch64 --build-path edge-hub/watchdog
    - task: PublishPipelineArtifact@1
      inputs:
        targetPath: 'edge-hub/watchdog/target/aarch64-unknown-linux-gnu/release/watchdog'
        artifactName: watchdog_arm64
        artifactType: 'pipeline'    
