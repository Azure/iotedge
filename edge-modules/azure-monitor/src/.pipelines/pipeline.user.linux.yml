environment:
  host:
    os: 'linux'
    flavor: 'ubuntu'
    version: '18.04'
  runtime:
    provider: 'appcontainer'
    image: 'cdpxlinux.azurecr.io/global/ubuntu-1804-node10:1.0'

version:
  major: 0                                        # The major version number.
  minor: 1                                        # The minor version number
  system: 'patch'
  name: 'Azure Monitor for IoT Edge'              # The name of the project
  exclude_commit: false                           # Set to true if you would like to exclude the commit hash from the build number.


restore:
  commands:
  - !!defaultcommand
      name: 'restore'
      command: '.pipelines/install_jq.sh'
      

build:
  commands:
    - !!defaultcommand
      name: 'build amd 64 image'
      command: '.pipelines/write_vernum_script.sh'
      

package:
  commands:
    - !!dockerbuildcommand
      name: 'build image amd64'
      context_folder: 'modules/AzureMonitorForIotEdgeModule'
      dockerfile_name: 'Dockerfile.amd64'
      repository_name: 'cdpxlinux'
      tag: 'cidev'
      export_to_artifact_path: 'images/module-amd64.tar.gz'

    - !!dockerbuildcommand
      name: 'build image arm32v7'
      context_folder: 'modules/AzureMonitorForIotEdgeModule'
      dockerfile_name: 'Dockerfile.arm32v7'
      repository_name: 'cdpxlinux'
      tag: 'cidev'
      export_to_artifact_path: 'images/module-arm32v7.tar.gz'

    - !!dockerbuildcommand
      name: 'build image arm64v8'
      context_folder: 'modules/AzureMonitorForIotEdgeModule'
      dockerfile_name: 'Dockerfile.arm64v8'
      repository_name: 'cdpxlinux'
      tag: 'cidev'
      export_to_artifact_path: 'images/module-arm64v8.tar.gz'
      